<app-toolbar title="Tasks" [showDashboardButton]="true"></app-toolbar>

<div class="container" style="margin: 0px 16px">
  <div class="task-box">
    <div class="actions">
      <div style="margin: 16px 0px">
        <button mat-raised-button color="primary" (click)="openAddPopup()">
          <mat-icon>add</mat-icon>
          Add Task
        </button>
      </div>
    </div>

    <div class="searchbar-container">
      <mat-form-field appearance="outline" class="searchbar">
        <mat-icon matPrefix>search</mat-icon>
        <input
          matInput
          [(ngModel)]="searchTerm"
          (input)="applyFilter($event)"
          placeholder="Search tasks"
        />
        <button
          *ngIf="searchTerm"
          mat-icon-button
          matSuffix
          (click)="clearSearch()"
          aria-label="Clear search"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class="table-wrapper">
      <table
        mat-table
        [dataSource]="filteredTasks"
        class="mat-elevation-z2 task-table"
        matSort
      >
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
          <td mat-cell *matCellDef="let task">{{ task.title }}</td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="description-cell"
            mat-sort-header
          >
            Description
          </th>
          <td mat-cell *matCellDef="let task" class="description-cell">
            {{ task.description }}
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let task">
            {{ getStatusDescription(task.status) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let task">
            <div class="action-row">
              <mat-checkbox
                [checked]="task.status === TaskItemStatus.Completed"
                (change)="toggle(task)"
                matTooltip="Mark as Completed"
                matTooltipPosition="above"
              ></mat-checkbox>
          
              <button mat-button color="accent" (click)="edit(task)">
                <mat-icon>edit</mat-icon>
                <span class="action-label">Edit</span>
              </button>
          
              <button mat-button color="warn" (click)="delete(task.id)">
                <mat-icon>delete</mat-icon>
                <span class="action-label">Delete</span>
              </button>
            </div>
          </td>
          
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </div>
</div>

<div *ngIf="popupVisible" class="modal-overlay">
  <div class="modal-content">
    <app-task-popup
      [task]="editingTask"
      (save)="onSave($event)"
      (cancel)="onCancel()"
    ></app-task-popup>
  </div>
</div>

<app-message-popup
  *ngIf="popupMessage"
  [message]="popupMessage"
  [type]="popupType"
  (close)="popupMessage = null"
></app-message-popup>
